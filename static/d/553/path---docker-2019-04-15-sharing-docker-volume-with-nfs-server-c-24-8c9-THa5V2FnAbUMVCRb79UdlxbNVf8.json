{"data":{"site":{"siteMetadata":{"title":"Kinuz Blog","subtitle":"","copyright":"Â© All rights reserved.","author":{"name":"Kinuz","twitter":"#"},"disqusShortname":"NuzHome","url":"https://kinuz.netlify.com"}},"markdownRemark":{"id":"48d77aaf-fe02-5c60-9ce4-8d186eb8ec77","html":"<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d81e574f8029fd6dccd6d8bcc04798bb/ef000/composer-resources.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 498px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 75.3012048192771%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABk0lEQVQoz5VSQU7CQBTtHbyBG+M93Bh3xsSFBzAuXKob76BRYWGixhg3EIOUuCECJrgRalQwQYoKGmoLkVY6bWmnM1OHVmIpNcGXn6Zt/pv35/3HOGFACF0X7/dPz/I3HP0khIS2MaF/aS9EWNV0hLHzN0LIVMd2AVQVI2QPgEcOYgI0+rQsS1VV0zQNw+i5oO8AAE3TgmTiIKrkleOSTdOiFejDGNEjXAGbYLcIYgITOxgiU7ehNbj7zziiKJbLZQjhkLKlZPVWAkjnUL7ofDaWttjlo8uapPTVBiZT8zmuEIsnhcZV93HhozAvFmbV2joj3829pyfr6almbpqA25nN2MRKdCeVdxC00a9D2Vzm4OC41SwCfqNdWms/rIL6LuPOhvuXIog2lSr83uFJPJFsSZK3J29slmWjkQi10L/2kFVhuhYYNEwQBJ7nXc+Q3zDiK4eq4bA8Ubeh2RsrJKN5NEwoyepY8RzKuXvONtdZTAleyMj4ZAobk8yrwlZlHf6H7M2vfHWfnl/KlepbU/CTvwGe31ckQdTkhQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Computer Resources\"\n        title=\"\"\n        src=\"/static/d81e574f8029fd6dccd6d8bcc04798bb/ef000/composer-resources.png\"\n        srcset=\"/static/d81e574f8029fd6dccd6d8bcc04798bb/0783d/composer-resources.png 240w,\n/static/d81e574f8029fd6dccd6d8bcc04798bb/782f4/composer-resources.png 480w,\n/static/d81e574f8029fd6dccd6d8bcc04798bb/ef000/composer-resources.png 498w\"\n        sizes=\"(max-width: 498px) 100vw, 498px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>To test nfs-server, i prepared 2 resources. Both are under manjaro OS, docker has been installed.\nAnd for nfs, had to install following package. </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ yay -S nfs-utils</code></pre></div>\n<p>on Ubuntu, </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> nfs-common</code></pre></div>\n<h2>On a machine - A8-7600 : Running a server</h2>\n<h4>Directory structure.</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/opt\n /swarm\n   /nfs-server\n     - docker-compose.yml\n     - exports.txt\n     /nfs-share-data</code></pre></div>\n<h4>1. create directory recursively.</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> -p /opt/swarm/nfs-server/nfs-share-data</code></pre></div>\n<h4>2. create following yaml file for nfs container running.</h4>\n<p>docker-compose.yml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.7'</span>\n\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">nfs</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> erichough/nfs<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">:</span>2.2.1\n    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>server\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token string\">'2049:2049'</span>\n    <span class=\"token key atrule\">privileged</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> ./nfs<span class=\"token punctuation\">-</span>share<span class=\"token punctuation\">-</span>data<span class=\"token punctuation\">:</span>/data\n      <span class=\"token punctuation\">-</span> ./exports.txt<span class=\"token punctuation\">:</span>/etc/exports\n    <span class=\"token key atrule\">network_mode</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"host\"</span>\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</code></pre></div>\n<h4>3. create a exports.txt file to mount a container.</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/data *(rw,fsid=0,sync,no_subtree_check,no_auth_nlm,insecure,no_root_squash)</code></pre></div>\n<h4>4. run nfs server</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker-compose up -d</code></pre></div>\n<p><a href=\"https://asciinema.org/a/BHNmOrdVihGn3Q7d9Rp0tkO1u\"><img src=\"https://asciinema.org/a/BHNmOrdVihGn3Q7d9Rp0tkO1u.svg\" alt=\"asciicast\"></a></p>\n<h2>On a machine - E6400 : client test</h2>\n<h4>1. Connect to a clinet machine</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ssh</span> 192.168.0.4</code></pre></div>\n<h4>2. create directory</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> /opt/nfs-data</code></pre></div>\n<h4>3. mount</h4>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">mount</span> -v 192.168.0.3:/ /opt/nfs-data</code></pre></div>\n<p><a href=\"https://asciinema.org/a/Vjn1H69CXN89jJXXsYjIE99GW\"><img src=\"https://asciinema.org/a/Vjn1H69CXN89jJXXsYjIE99GW.svg\" alt=\"asciicast\"></a></p>\n<h2>Check nfs working</h2>\n<ol>\n<li>open terminals for server and client.</li>\n</ol>\n<p><img src=\"/file-synchronized-2c787cc0d30e24741faa23639fe1bd12.gif\" alt=\"File Synchronized\"></p>","fields":{"tagSlugs":["/tags/docker/","/tags/nfs/"]},"frontmatter":{"title":"Sharing docker volume with NFS Server","tags":["docker","nfs"],"date":"2019-04-14T15:37:57.000Z","description":null,"refs":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/docker/2019/04/15/sharing-docker-volume-with-nfs-server"}}