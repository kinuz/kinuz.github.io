{"data":{"site":{"siteMetadata":{"title":"Kinuz Blog","subtitle":"","copyright":"© All rights reserved.","author":{"name":"Kinuz","twitter":"#"},"disqusShortname":"NuzHome","url":"https://kinuz.netlify.com"}},"markdownRemark":{"id":"1c40eec3-3b9d-5d7f-b2e1-27302a0c6072","html":"<p><a href=\"/docker/2019/04/02/portainer-making-docker-management-easy\">Portainer - Making Docker Management Easy.</a></p>\n<p>to make it clear, remove previous data from stack and volume.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker stack <span class=\"token function\">rm</span> portainer\n$ docker volume <span class=\"token function\">rm</span> portainer_portainer_data\n\n$ docker <span class=\"token function\">service</span> <span class=\"token function\">ls</span>\n$ docker volume <span class=\"token function\">ls</span></code></pre></div>\n<p>move yaml file to a /opt/swarm/portainer directory and start a service.  </p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">cd</span> /opt/swarm/portainer\n/opt/swarm/portainer@ $ docker stack deploy -c portainer.yml portainer\n/opt/swarm/portainer@ $ docker inspect portainer_data</code></pre></div>\n<p>inspect volume data and check the directory in the mountpoint.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker volume inspect portainer_portainer_data \n<span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"CreatedAt\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"2019-04-15T21:31:37+09:00\"</span>,\n        <span class=\"token string\">\"Driver\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"local\"</span>,\n        <span class=\"token string\">\"Labels\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"com.docker.stack.namespace\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"portainer\"</span>\n        <span class=\"token punctuation\">}</span>,\n        <span class=\"token string\">\"Mountpoint\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"/var/lib/docker/volumes/portainer_portainer_data/_data\"</span>,\n        <span class=\"token string\">\"Name\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"portainer_portainer_data\"</span>,\n        <span class=\"token string\">\"Options\"</span><span class=\"token keyword\">:</span> null,\n        <span class=\"token string\">\"Scope\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"local\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">ls</span> -al /var/lib/docker/volumes/portainer_portainer_data/_data\ntotal 144\ndrwxr-xr-x 5 root root   4096  4월 15 21:31 <span class=\"token keyword\">.</span>\ndrwxr-xr-x 3 root root   4096  4월 15 21:31 <span class=\"token punctuation\">..</span>\ndrwx------ 2 root root   4096  4월 15 21:31 bin\ndrwx------ 2 root root   4096  4월 15 21:31 compose\n-rw-r--r-- 1 root root    389  4월 15 21:31 config.json\n-rw------- 1 root root 131072  4월 15 21:31 portainer.db\n-rw------- 1 root root    227  4월 15 21:31 portainer.key\n-rw------- 1 root root    190  4월 15 21:31 portainer.pub\ndrwx------ 2 root root   4096  4월 15 21:31 tls</code></pre></div>\n<p><a href=\"https://asciinema.org/a/8hDRpZTQoKrFOqkn3Bn3JRvMy\"><img src=\"https://asciinema.org/a/8hDRpZTQoKrFOqkn3Bn3JRvMy.svg\" alt=\"asciicast\"></a></p>\n<p>As we check at the beginning of this post, all the files and directories on <code class=\"language-text\">/var/lib/docker/volumes/portainer_portainer_data/_data</code> will be deleted by removing portainer_data volume.\nTo make it persistent, made some changes on volume section like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">portainer_data</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">driver</span><span class=\"token punctuation\">:</span> local\n    <span class=\"token key atrule\">driver_opts</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> none\n      <span class=\"token key atrule\">device</span><span class=\"token punctuation\">:</span> /opt/swarm/portainer/data\n      <span class=\"token key atrule\">o</span><span class=\"token punctuation\">:</span> bind</code></pre></div>\n<p>Then repeat previous actions.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ docker volume inspect portainer_portainer_data\n<span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"CreatedAt\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"2019-04-15T21:53:20+09:00\"</span>,\n        <span class=\"token string\">\"Driver\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"local\"</span>,\n        <span class=\"token string\">\"Labels\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"com.docker.stack.namespace\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"portainer\"</span>\n        <span class=\"token punctuation\">}</span>,\n        <span class=\"token string\">\"Mountpoint\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"/var/lib/docker/volumes/portainer_portainer_data/_data\"</span>,\n        <span class=\"token string\">\"Name\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"portainer_portainer_data\"</span>,\n        <span class=\"token string\">\"Options\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"device\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"/opt/portainer\"</span>,\n            <span class=\"token string\">\"o\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"bind\"</span>,\n            <span class=\"token string\">\"type\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"none\"</span>\n        <span class=\"token punctuation\">}</span>,\n        <span class=\"token string\">\"Scope\"</span><span class=\"token keyword\">:</span> <span class=\"token string\">\"local\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">ls</span> -al /opt/swarm/portainer/data\ntotal 132\ndrwxr-xr-x 5 jun  jun    4096  4월 15 21:53 <span class=\"token keyword\">.</span>\ndrwxr-xr-x 3 jun  jun    4096  4월 15 21:52 <span class=\"token punctuation\">..</span>\ndrwx------ 2 root root   4096  4월 15 21:47 bin\ndrwx------ 2 root root   4096  4월 15 21:47 compose\n-rw-r--r-- 1 root root    389  4월 15 21:53 config.json\n-rw------- 1 root root 131072  4월 15 21:53 portainer.db\n-rw------- 1 root root    227  4월 15 21:53 portainer.key\n-rw------- 1 root root    190  4월 15 21:53 portainer.pub\ndrwx------ 2 root root   4096  4월 15 21:47 tls\n\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">ls</span> -al /var/lib/docker/volumes/portainer_portainer_data/_data\ntotal 132\ndrwxr-xr-x 5 jun  jun    4096  4월 15 21:53 <span class=\"token keyword\">.</span>\ndrwxr-xr-x 3 root root   4096  4월 15 21:53 <span class=\"token punctuation\">..</span>\ndrwx------ 2 root root   4096  4월 15 21:47 bin\ndrwx------ 2 root root   4096  4월 15 21:47 compose\n-rw-r--r-- 1 root root    389  4월 15 21:53 config.json\n-rw------- 1 root root 131072  4월 15 21:53 portainer.db\n-rw------- 1 root root    227  4월 15 21:53 portainer.key\n-rw------- 1 root root    190  4월 15 21:53 portainer.pub\ndrwx------ 2 root root   4096  4월 15 21:47 tls</code></pre></div>\n<p><a href=\"https://asciinema.org/a/54KATbTzY3viIg7shXQkTW5K8\"><img src=\"https://asciinema.org/a/54KATbTzY3viIg7shXQkTW5K8.svg\" alt=\"asciicast\"></a></p>\n<p>Now, all the files under /opt/swarm/portainer/data will keep remain though the portainer stack removed. </p>","fields":{"tagSlugs":["/tags/docker/","/tags/docker-volume/"]},"frontmatter":{"title":"bind volume to a host machine on a swarm cluster","tags":["docker","docker volume"],"date":"2019-04-13T17:13:42.000Z","description":null,"refs":["https://docs.docker.com/storage/bind-mounts/"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/docker/2019/04/14/bind-volume-to-a-host-machine-on-a-swarm-cluster"}}